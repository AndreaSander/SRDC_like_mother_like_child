library(formattable)
library(here)
library(lme4)
library(lmerTest)
library(rstatix)
library(papeR)
library(knitr)
library(waffle)
library(ggsankey)
library(dplyr)
library(tidyverse)
load(here("anonymized_data/final_merged_data.Rda"))
load(here("anonymized_data/final_data_no_exc.Rda"))
load(here("anonymized_data/final_data_strat.Rda"))
load(here("anonymized_data/longitudinal_data.Rda"))
#Saving my palette to use in visualizations
my_yellow<-"#FFC107"
my_orange<- "#D95F02"
my_blue<- "#1F78B4"
my_green<- "#33a02c"
my_purple<- "#7570b3"
#select only relevant variables
longitudinal_data <- longitudinal_data %>%
select(age, strategy, unique_id, anon_baby_id)
longitudinal_data<- longitudinal_data %>%
arrange(anon_baby_id, age) %>%
group_by(anon_baby_id) %>%
mutate(visit = row_number()) %>%
ungroup()
wider_longitudinal <- longitudinal_data %>%
select(anon_baby_id, visit, strategy) %>%
filter(str_detect(strategy, "single-parent", negate=T))
wider_longitudinal <- pivot_wider(wider_longitudinal,
names_from = visit, values_from = strategy ) %>%
rename(visit_1 = "1", visit_2 = "2", visit_3 ="3", visit_4 ="4" )
for_sankey <- wider_longitudinal %>%
make_long(visit_1, visit_2)
View(for_sankey)
p1<- ggplot(for_sankey, aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = factor(node), label=node)) +
geom_sankey()
View(p1)
#select only relevant variables
longitudinal_data <- longitudinal_data %>%
select(age, strategy, unique_id, anon_baby_id)
longitudinal_data<- longitudinal_data %>%
arrange(anon_baby_id, age) %>%
group_by(anon_baby_id) %>%
mutate(visit = row_number()) %>%
ungroup()
wider_longitudinal <- longitudinal_data %>%
select(anon_baby_id, visit, strategy) %>%
filter(str_detect(strategy, "single-parent", negate=T))
wider_longitudinal <- pivot_wider(wider_longitudinal,
names_from = visit, values_from = strategy ) %>%
rename(visit_1 = "1", visit_2 = "2", visit_3 ="3", visit_4 ="4" )
for_sankey <- wider_longitudinal %>%
make_long(visit_1, visit_2)
for_sankey <- for_sankey %>%
mutate(node= fct_relevel (node, "both-parents-bilingual", "one-parent-bilingual", "one-language-at-home", "one-parent-one-language"))
p1<- ggplot(for_sankey, aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = factor(node), label=node)) +
geom_sankey()
p2<- p1+
scale_fill_manual(name= "x", values = c(my_yellow, my_blue, my_orange, my_green))
p2<- p2 +
geom_sankey_label(size=3, color="black", fill="white")+
theme_bw()+
theme(legend.position = "none", axis.ticks = element_blank(), axis.text.y = element_blank()) +
labs(title="Stability of Family Strategies Across Visit", x="")
print(p2)
#select only relevant variables
longitudinal_data <- longitudinal_data %>%
select(age, strategy, unique_id, anon_baby_id)
longitudinal_data<- longitudinal_data %>%
arrange(anon_baby_id, age) %>%
group_by(anon_baby_id) %>%
mutate(visit = row_number()) %>%
ungroup()
wider_longitudinal <- longitudinal_data %>%
select(anon_baby_id, visit, strategy) %>%
filter(str_detect(strategy, "single-parent", negate=T))
wider_longitudinal <- pivot_wider(wider_longitudinal,
names_from = visit, values_from = strategy ) %>%
rename(visit_1 = "1", visit_2 = "2", visit_3 ="3", visit_4 ="4" )
for_sankey <- wider_longitudinal %>%
make_long(visit_1, visit_2)
for_sankey <- for_sankey %>%
mutate(node= fct_relevel (node, "both-parents-bilingual", "one-parent-bilingual", "one-language-at-home", "one-parent-one-language"))
p1<- ggplot(for_sankey, aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = factor(node), label=paste0(node," n=", n))) +
geom_sankey()
p2<- p1+
scale_fill_manual(name= "x", values = c(my_yellow, my_blue, my_orange, my_green))
p2<- p2 +
geom_sankey_label(size=3, color="black", fill="white")+
theme_bw()+
theme(legend.position = "none", axis.ticks = element_blank(), axis.text.y = element_blank()) +
labs(title="Stability of Family Strategies Across Visit", x="")
print(p2)
#select only relevant variables
longitudinal_data <- longitudinal_data %>%
select(age, strategy, unique_id, anon_baby_id)
longitudinal_data<- longitudinal_data %>%
arrange(anon_baby_id, age) %>%
group_by(anon_baby_id) %>%
mutate(visit = row_number()) %>%
ungroup()
wider_longitudinal <- longitudinal_data %>%
select(anon_baby_id, visit, strategy) %>%
filter(str_detect(strategy, "single-parent", negate=T))
wider_longitudinal <- pivot_wider(wider_longitudinal,
names_from = visit, values_from = strategy ) %>%
rename(visit_1 = "1", visit_2 = "2", visit_3 ="3", visit_4 ="4" )
for_sankey <- wider_longitudinal %>%
make_long(visit_1, visit_2)
for_sankey <- for_sankey %>%
mutate(node= fct_relevel (node, "both-parents-bilingual", "one-parent-bilingual", "one-language-at-home", "one-parent-one-language"))
p1<- ggplot(for_sankey, aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = factor(node), label=node)) +
geom_sankey()
p2<- p1+
scale_fill_manual(name= "x", values = c(my_yellow, my_blue, my_orange, my_green))
p2<- p2 +
geom_sankey_label(size=3, color="black", fill="white")+
theme_bw()+
theme(legend.position = "none", axis.ticks = element_blank(), axis.text.y = element_blank()) +
labs(title="Stability of Family Strategies Across Visit", x="")
print(p2)
for_n<- for_sankey %>%
group_by(node)%>%
tally()
#select only relevant variables
longitudinal_data <- longitudinal_data %>%
select(age, strategy, unique_id, anon_baby_id)
longitudinal_data<- longitudinal_data %>%
arrange(anon_baby_id, age) %>%
group_by(anon_baby_id) %>%
mutate(visit = row_number()) %>%
ungroup()
wider_longitudinal <- longitudinal_data %>%
select(anon_baby_id, visit, strategy) %>%
filter(str_detect(strategy, "single-parent", negate=T))
wider_longitudinal <- pivot_wider(wider_longitudinal,
names_from = visit, values_from = strategy ) %>%
rename(visit_1 = "1", visit_2 = "2", visit_3 ="3", visit_4 ="4" )
for_sankey <- wider_longitudinal %>%
make_long(visit_1, visit_2)
for_sankey <- for_sankey %>%
mutate(node= fct_relevel (node, "both-parents-bilingual", "one-parent-bilingual", "one-language-at-home", "one-parent-one-language"))
for_n<- for_sankey %>%
group_by(node)%>%
tally()
for_sankey2<- merge(for_sankey, for_n, by.x='node', by.y='node', all.x=TRUE)
p1<- ggplot(for_sankey2, aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = factor(node), label=paste0(node," n=", n))) +
geom_sankey()
p2<- p1+
scale_fill_manual(name= "x", values = c(my_yellow, my_blue, my_orange, my_green))
p2<- p2 +
geom_sankey_label(size=3, color="black", fill="white")+
theme_bw()+
theme(legend.position = "none", axis.ticks = element_blank(), axis.text.y = element_blank()) +
labs(title="Stability of Family Strategies Across Visit", x="")
print(p2)
View(for_n)
library(lubridate)
library(sparkline)
library(webshot)
library(htmlwidgets)
library(formattable)
library(here)
library(lme4)
library(lmerTest)
library(rstatix)
library(papeR)
library(knitr)
library(waffle)
library(ggsankey)
library(dplyr)
library(tidyverse)
load(here("anonymized_data/final_merged_data.Rda"))
load(here("anonymized_data/final_data_no_exc.Rda"))
load(here("anonymized_data/final_data_strat.Rda"))
load(here("anonymized_data/longitudinal_data.Rda"))
#Saving my palette to use in visualizations
my_yellow<-"#FFC107"
my_orange<- "#D95F02"
my_blue<- "#1F78B4"
my_green<- "#33a02c"
my_purple<- "#7570b3"
#select only relevant variables
longitudinal_data <- longitudinal_data %>%
select(age, strategy, unique_id, anon_baby_id)
longitudinal_data<- longitudinal_data %>%
arrange(anon_baby_id, age) %>%
group_by(anon_baby_id) %>%
mutate(visit = row_number()) %>%
ungroup()
wider_longitudinal <- longitudinal_data %>%
select(anon_baby_id, visit, strategy) %>%
filter(str_detect(strategy, "single-parent", negate=T))
wider_longitudinal <- pivot_wider(wider_longitudinal,
names_from = visit, values_from = strategy ) %>%
rename(visit_1 = "1", visit_2 = "2", visit_3 ="3", visit_4 ="4" )
for_sankey <- wider_longitudinal %>%
make_long(visit_1, visit_2)
for_sankey <- for_sankey %>%
mutate(node= fct_relevel (node, "both-parents-bilingual", "one-parent-bilingual", "one-language-at-home", "one-parent-one-language"))
View(for_sankey)
for_n_node1<- for_sankey %>%
group_by(node)%>%
tally()
for_n_node2<- for_sankey %>%
group_by(next_node)%>%
tally()
View(for_n_node1)
View(for_n_node2)
print(p2)
#select only relevant variables
longitudinal_data <- longitudinal_data %>%
select(age, strategy, unique_id, anon_baby_id)
longitudinal_data<- longitudinal_data %>%
arrange(anon_baby_id, age) %>%
group_by(anon_baby_id) %>%
mutate(visit = row_number()) %>%
ungroup()
wider_longitudinal <- longitudinal_data %>%
select(anon_baby_id, visit, strategy) %>%
filter(str_detect(strategy, "single-parent", negate=T))
wider_longitudinal <- pivot_wider(wider_longitudinal,
names_from = visit, values_from = strategy ) %>%
rename(visit_1 = "1", visit_2 = "2", visit_3 ="3", visit_4 ="4" )
for_sankey <- wider_longitudinal %>%
make_long(visit_1, visit_2)
for_sankey <- for_sankey %>%
mutate(node= fct_relevel (node, "both-parents-bilingual", "one-parent-bilingual", "one-language-at-home", "one-parent-one-language"))
p1<- ggplot(for_sankey, aes(x = x,
next_x = next_x,
node = node,
next_node = next_node,
fill = factor(node), label=node )) +
geom_sankey()
p2<- p1+
scale_fill_manual(name= "x", values = c(my_yellow, my_blue, my_orange, my_green))
p2<- p2 +
geom_sankey_label(size=3, color="black", fill="white")+
theme_bw()+
theme(legend.position = "none", axis.ticks = element_blank(), axis.text.y = element_blank()) +
labs(title="Stability of Family Strategies Across Visit", x="")
print(p2)
View(longitudinal_data)
v1_strat_prop <- longitudinal_data %>%
select(visit, strategy) %>%
filter(visit==1) %>%
tally()
View(v1_strat_prop)
v1_strat_prop <- longitudinal_data %>%
select(visit, strategy) %>%
filter(visit==1) %>%
group_by(strategy) %>%
tally()
View(v1_strat_prop)
v1_strat_prop <- longitudinal_data %>%
select(visit, strategy) %>%
filter(visit==1) %>%
filter(!strategy == "single=parent") %>%
group_by(strategy) %>%
tally()%>%
mutate(prop = n/sum(n)) %>%
mutate(perc= prop*100)
View(v1_strat_prop)
v2_strat_prop <- longitudinal_data %>%
select(visit, strategy) %>%
filter(visit==2) %>%
filter(!strategy == "single=parent") %>%
group_by(strategy) %>%
tally()%>%
mutate(prop = n/sum(n)) %>%
mutate(perc= prop*100)
View(v2_strat_prop)
test<- merge(v1_strat_prop, v2_strat_prop, by=strategy)
test<- merge(v1_strat_prop, v2_strat_prop, by="strategy")
View(test)
percentages_visits <- merge(v1_strat_prop, v2_strat_prop, by="strategy") %>%
select(strategy, n.x, n.y, pec.x, perc.y)
percentages_visits <- merge(v1_strat_prop, v2_strat_prop, by="strategy")
percentages_visits <- percentages_visits %>%
select(strategy, n.x, n.y, pec.x, perc.y)
View(percentages_visits)
percentages_visits <- percentages_visits %>%
select(strategy, n.x, n.y, perc.x, perc.y)
?rename
percentages_visits <- percentages_visits %>%
select(strategy, n.x, n.y, perc.x, perc.y) %>%
rename(n.x, n_first_visit)
percentages_visits <- percentages_visits %>%
select(strategy, n.x, n.y, perc.x, perc.y) %>%
rename(n_first_visit, n.x)
percentages_visits <- percentages_visits %>%
select(strategy, n.x, n.y, perc.x, perc.y) %>%
rename(n_first_visit = n.x)
View(percentages_visits)
percentages_visits <- percentages_visits %>%
select(strategy, n.x, n.y, perc.x, perc.y) %>%
rename(n_first_visit = n.x) %>%
rename(n_second_visit = n.y) %>%
rename(percentage_first_visit = perc.x) %>%
rename(percentage_second_visit = perc.y)
library(lubridate)
library(sparkline)
library(webshot)
library(htmlwidgets)
library(formattable)
library(here)
library(lme4)
library(lmerTest)
library(rstatix)
library(papeR)
library(knitr)
library(waffle)
library(ggsankey)
library(dplyr)
library(tidyverse)
load(here("anonymized_data/final_merged_data.Rda"))
load(here("anonymized_data/final_data_no_exc.Rda"))
load(here("anonymized_data/final_data_strat.Rda"))
load(here("anonymized_data/longitudinal_data.Rda"))
#Saving my palette to use in visualizations
my_yellow<-"#FFC107"
my_orange<- "#D95F02"
my_blue<- "#1F78B4"
my_green<- "#33a02c"
my_purple<- "#7570b3"
#select only relevant variables
longitudinal_data <- longitudinal_data %>%
select(age, strategy, unique_id, anon_baby_id)
longitudinal_data<- longitudinal_data %>%
arrange(anon_baby_id, age) %>%
group_by(anon_baby_id) %>%
mutate(visit = row_number()) %>%
ungroup()
v1_strat_prop <- longitudinal_data %>%
select(visit, strategy) %>%
filter(visit==1) %>%
filter(!strategy == "single=parent") %>%
group_by(strategy) %>%
tally()%>%
mutate(prop = n/sum(n)) %>%
mutate(perc= prop*100)
v2_strat_prop <- longitudinal_data %>%
select(visit, strategy) %>%
filter(visit==2) %>%
filter(!strategy == "single=parent") %>%
group_by(strategy) %>%
tally()%>%
mutate(prop = n/sum(n)) %>%
mutate(perc= prop*100)
percentages_visits <- merge(v1_strat_prop, v2_strat_prop, by="strategy")
percentages_visits <- percentages_visits %>%
select(strategy, n.x, n.y, perc.x, perc.y) %>%
rename(n_first_visit = n.x) %>%
rename(n_second_visit = n.y) %>%
rename(percentage_first_visit = perc.x) %>%
rename(percentage_second_visit = perc.y)
View(v1_strat_prop)
v1_strat_prop <- longitudinal_data %>%
select(visit, strategy) %>%
filter(visit==1) %>%
filter(!strategy == "single=parent") %>%
group_by(strategy) %>%
tally()%>%
mutate(prop = n/sum(n)) %>%
mutate(perc= prop*100)
View(v1_strat_prop)
library(lubridate)
library(sparkline)
library(webshot)
library(htmlwidgets)
library(formattable)
library(here)
library(lme4)
library(lmerTest)
library(rstatix)
library(papeR)
library(knitr)
library(waffle)
library(ggsankey)
library(dplyr)
library(tidyverse)
load(here("anonymized_data/final_merged_data.Rda"))
load(here("anonymized_data/final_data_no_exc.Rda"))
load(here("anonymized_data/final_data_strat.Rda"))
load(here("anonymized_data/longitudinal_data.Rda"))
#Saving my palette to use in visualizations
my_yellow<-"#FFC107"
my_orange<- "#D95F02"
my_blue<- "#1F78B4"
my_green<- "#33a02c"
my_purple<- "#7570b3"
#### CONSTRUCTING AND DESCRIBING ALL RELEVANT DATA SETS ####
#Exclusions count
total_excluded<- final_data_no_exc %>%
group_by(unique_id, exp_l1, exp_l2)%>%
mutate(total_l1_l2_exp=(sum(exp_l1,exp_l2,na.rm = T))) %>%
ungroup() %>%
filter(total_l1_l2_exp<=90) %>%
distinct(unique_id)%>%
tally()
#after third language exclusions exclusions
n <- final_data %>%
distinct(unique_id) %>%
tally()
#subseting to get data only from each child's first visit to the lab. For main analyses
first_visit_only <- final_data_strat%>%
arrange(anon_baby_id, age) %>%
group_by(anon_baby_id) %>%
mutate(visit = row_number()) %>%
ungroup() %>%
filter(visit==1) #439 data from first visit only
#n when only taking first visit
n_keep_first_visit<-first_visit_only %>%
distinct(unique_id)%>%
tally()
age_min <- round(min(first_visit_only$age, na.rm = T), 2)
age_max<- round(max(first_visit_only$age, na.rm = T), 2)
age_mean<- round(mean(first_visit_only$age, na.rm = T), 2)
age_sd<- round(sd(first_visit_only$age, na.rm = T), 2)
female<- first_visit_only %>%
filter(gender=="female")%>%
distinct(unique_id)%>%
tally()
twice_visit <- final_data %>%
add_count(anon_baby_id) %>%
filter(nn==2)%>%
distinct(unique_id)%>%
tally()
three_visit <- final_data %>%
add_count(anon_baby_id) %>%
filter(nn==3)%>%
distinct(unique_id)%>%
tally()
four_visit <- final_data %>%
add_count(anon_baby_id) %>%
filter(nn>3)%>%
distinct(unique_id)%>%
tally()
#l1 percentages
l1_perc <- first_visit_only %>%
group_by(l1) %>%
tally() %>%
mutate(prop = n/sum(n)) %>%
mutate(perc= prop*100)
fre_l1 <- l1_perc %>%
filter(l1=="French") %>%
select(perc)
eng_l1 <- l1_perc %>%
filter(l1=="English") %>%
select(perc)
min_l1<- abs(fre_l1-eng_l1)
#l2 percentages
l2_perc <- first_visit_only %>%
group_by(l2) %>%
tally() %>%
mutate(prop = n/sum(n)) %>%
mutate(perc= prop*100)
fre_l2 <- l2_perc %>%
filter(l2=="French") %>%
select(perc)
eng_l2 <- l2_perc %>%
filter(l2=="English") %>%
select(perc)
min_l2<- abs(fre_l2-eng_l2)
#Longitudinal data set n
n_long <-longitudinal_data %>%
distinct(unique_id)%>%
tally()
#Longitudinal data set length between visit one and 2
visit_length<- longitudinal_data %>%
arrange(anon_baby_id, age) %>%
group_by(anon_baby_id) %>%
mutate(visit = row_number()) %>%
ungroup() %>%
filter(nn==2) %>%
mutate(first_visit_date = case_when(visit == 1 ~ leq_date)) %>%
mutate(second_visit_date = case_when(visit == 2 ~ leq_date)) %>%
select(anon_baby_id, first_visit_date, second_visit_date) %>%
group_by(anon_baby_id) %>%
fill(first_visit_date, second_visit_date, .direction="updown") %>% #to collapse the rows and be able to calculate visit
distinct() %>%
ungroup() %>%
mutate(length_between_visits = abs(interval(start= first_visit_date, end=second_visit_date)/ duration (n=1, unit="days" )))
##!! There is a mistake in one date which results in a negative date. Fix.
avg_visit_l <- round(mean(visit_length$length_between_visits), 2)
min_visit_l <- round(min(visit_length$length_between_visits),2)
max_visit_l <- round(max(visit_length$length_between_visits),2)
sd_visit_l <- round(sd(visit_length$length_between_visits),2)
